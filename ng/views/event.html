<div class="container">
    <title>Events</title>
    <ul class="nav nav-tabs nav-justified">
        <li ng-click="ctrl.clearCreateData()" class="active">
            <a data-toggle="tab" data-target="#eventSearchBar">Event Search</a></li>
        <li ng-click="clearSearchData()"><a data-toggle="tab" data-target="#createEvent">Create Event</a></li>
        <li><a ng-click="switchToETTab()" data-toggle="tab" data-target="#eventTypePane">Modify Event Types</a></li>
    </ul>
    <div class="tab-content">
        <div id="eventSearchBar" class="tab-pane fade in active">
            <form class="form-signin" ng-submit="ctrl.searchEvents()" name="searchEvents" role="form">
                <div class="input-group">
                    <div class="input-group-addon min-width-one-six-one">
                        <label>
                            <input type="checkbox" data-ng-model="ctrl.advancedSearch"></input> Advanced
                        </label>
                    </div>
                    <div class="input-group-addon min-width-one-six-six">
                        <select class="min-width-one-forty" ng-model="ctrl.searchNameOperator" ng-change="ctrl.searchName=''">
                            <option value="">Choose Operator</option>
                            <option value="IS NULL">is null</option>
                            <option value="IS NOT NULL">is not null</option>
                            <option value="LIKE">like</option>
                            <option value="IS NOT LIKE">is not like</option>
                        </select>
                    </div>
                    <label for="inputSearch" class="sr-only">Search</label>
                    <input ng-disabled="(!ctrl.searchNameOperator && ctrl.advancedSearch )|| ctrl.searchNameOperator=='IS NOT NULL' || ctrl.searchNameOperator=='IS NULL'" type="text" name="search" data-ng-model="ctrl.searchName" id="inputSearch" class="form-control" placeholder="Event Name" ng-required="ctrl.searchNameOperator=='LIKE' || ctrl.searchNameOperator=='IS NOT LIKE'">
                    <span class="input-group-btn">
                         <button ng-disabled="form.$invalid" class="btn btn-primary" type="submit">Search</button>
                     </span>
                </div>
                <div ng-show="ctrl.advancedSearch">
                    <div class="input-group">
                        <div class="input-group-addon min-width-one-six-one">
                            <select ng-model="ctrl.searchTimeStartLogic">
                                <option value="">Choose Conjunction</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                            </select>
                        </div>
                        <div class="input-group-addon min-width-one-six-six">
                            <select class="min-width-one-forty" ng-model="ctrl.searchTimeStartOperator" ng-change="ctrl.searchTimeStart=''">>
                                <option value="">Choose Operator</option>
                                <option value="<">less than</option>
                                <option value="<=">less than or equal</option>
                                <option value="=">equal</option>
                                <option value=">">greater than</option>
                                <option value=">=">greater than or equal</option>
                                <option value="IS NOT NULL">is not null</option>
                                <option value="LIKE">like</option>
                                <option value="IS NOT LIKE">is not like</option>
                            </select>
                        </div>
                        <input ng-disabled="!ctrl.searchTimeStartLogic || !ctrl.searchTimeStartOperator|| ctrl.searchTimeStartOperator=='IS NOT NULL'" type="text" name="search" data-ng-model="ctrl.searchTimeStart" class="form-control" placeholder="Time Start" ng-pattern="/(20\d{2})-(0[1-9]|1[0-2])-(1[0-9]|2[0-9]|3[0-1]) (2[0-3]|0[1-9]|1[0-9]):(60|[0-5][0-9]):(60|[0-5][0-9])/" ng-required="ctrl.searchTimeStartOperator!='IS NOT NULL'">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon min-width-one-six-one">
                            <select ng-model="ctrl.searchTimeEndLogic">
                                <option value="">Choose Conjunction</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                            </select>
                        </div>
                        <div class="input-group-addon min-width-one-six-six">
                            <select class="min-width-one-forty" ng-model="ctrl.searchTimeEndOperator" ng-change="ctrl.searchTimeEnd=''">
                                <option value="">Choose Operator</option>
                                <option value="<">less than</option>
                                <option value="<=">less than or equal</option>
                                <option value="=">equal</option>
                                <option value=">">greater than</option>
                                <option value=">=">greater than or equal</option>
                                <option value="IS NOT NULL">is not null</option>
                                <option value="LIKE">like</option>
                                <option value="IS NOT LIKE">is not like</option>
                            </select>
                        </div>
                        <input ng-disabled="!ctrl.searchTimeEndLogic ||!ctrl.searchTimeEndOperator || ctrl.searchTimeEndOperator=='IS NOT NULL' || ctrl.searchTimeEndOperator=='IS NULL'" type="text " name="search " data-ng-model="ctrl.searchTimeEnd" class="form-control " placeholder="Time End" ng-pattern="/(20\d{2})-(0[1-9]|1[0-2])-(1[0-9]|2[0-9]|3[0-1]) (2[0-3]|0[1-9]|1[0-9]):(60|[0-5][0-9]):(60|[0-5][0-9])/" ng-required="ctrl.searchTimeEndOperator!='IS NOT NULL'">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon min-width-one-six-one">
                            <select ng-model="ctrl.searchDesctiptionLogic">
                                <option value="">Choose Conjunction</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                            </select>
                        </div>
                        <div class="input-group-addon min-width-one-six-six">
                            <select class="min-width-one-forty" ng-model="ctrl.searchDesctiptionOperator" ng-change="ctrl.searchDesctiption=''">
                                <option value="">Choose Operator</option>
                                <option value="IS NULL">is null</option>
                                <option value="IS NOT NULL">is not null</option>
                                <option value="LIKE">like</option>
                                <option value="IS NOT LIKE">is not like</option>
                            </select>
                        </div>
                        <input ng-disabled="!ctrl.searchDesctiptionLogic || !ctrl.searchDesctiptionOperator || ctrl.searchDesctiptionOperator=='IS NOT NULL' || ctrl.searchDesctiptionOperator=='IS NULL'" type="text" name="search" data-ng-model="ctrl.searchDesctiption " class="form-control " placeholder="Description" ng-required="ctrl.searchDesctiptionOperator=='LIKE' ||ctrl.searchDesctiptionOperator=='IS NOT LIKE'">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon min-width-one-six-one">
                            <select ng-model="ctrl.searchCostLogic">
                                <option value="">Choose Conjunction</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                            </select>
                        </div>
                        <div class="input-group-addon min-width-one-six-six">
                            <select class="min-width-one-forty" ng-model="ctrl.searchCostOperator" ng-change="ctrl.searchCost=''">
                                <option value="">Choose Operator</option>
                                <option value="<">less than</option>
                                <option value="<=">less than or equal</option>
                                <option value="=">equal</option>
                                <option value=">">greater than</option>
                                <option value=">=">greater than or equal</option>
                                <option value="IS NULL">is null</option>
                                <option value="IS NOT NULL">is not null</option>
                                <option value="LIKE">like</option>
                                <option value="IS NOT LIKE">is not like</option>
                            </select>
                        </div>
                        <input ng-disabled="!ctrl.searchCostLogic || !ctrl.searchCostOperator || ctrl.searchCostOperator=='IS NOT NULL' || ctrl.searchCostOperator=='IS NULL'" type="text" name="search" data-ng-model="ctrl.searchCost " class="form-control " placeholder="Cost" ng-required="ctrl.searchCostOperator!='IS NOT NULL' ||ctrl.searchCostOperator!='IS NULL'">
                    </div>
                    <div class="input-group">
                        <div class="input-group-addon min-width-one-six-one">
                            <select ng-model="ctrl.searchCreatedByLogic">
                                <option value="">Choose Conjunction</option>
                                <option value="and">and</option>
                                <option value="or">or</option>
                            </select>
                        </div>
                        <div class="input-group-addon min-width-one-six-six">
                            <select class="min-width-one-forty" ng-model="ctrl.searchCreatedByOperator" ng-change="ctrl.searchCreatedBy=''">
                                <option value="">Choose Operator</option>
                                <option value="IS NULL">is null</option>
                                <option value="IS NOT NULL">is not null</option>
                                <option value="LIKE">like</option>
                                <option value="IS NOT LIKE">is not like</option>
                            </select>
                        </div>
                        <input ng-disabled="!ctrl.searchCreatedByLogic || !ctrl.searchCreatedByOperator || ctrl.searchCreatedByOperator=='IS NOT NULL' || ctrl.searchCreatedByOperator=='IS NULL'" type="text" name="search" data-ng-model="ctrl.searchCreatedBy " class="form-control " placeholder="Created By" ng-required="ctrl.searchCreatedByOperator=='LIKE' ||ctrl.searchCreatedByOperator=='IS NOT LIKE'">
                    </div>
                </div>
                <!-- referenced: http://jsfiddle.net/mjaric/pj5br/ -->
                <table id="event-table" class="table-hover" border="1" ng-if="results">
                    <tr>
                        <th>Event Name</th>
                        <th>Time Start</th>
                        <th>Time End</th>
                        <th>Cost</th>
                    </tr>
                    <tr ng-hide="event.delete" ng-repeat="event in events" data-toggle="modal" data-target="#viewDetailModal" ng-click="ctrl.viewDetails(event)" ng-class="{'going': event.going==1}">
                        <td>{{event.eventName}}</td>
                        <td>{{event.timeStart}}</td>
                        <td>{{event.timeEnd}}</td>
                        <td>{{event.cost}}</td>
                    </tr>
                </table>
            </form>
        </div>
        <!-- Referencing http://www.w3schools.com/bootstrap/bootstrap_modal.asp-->
        <div id="viewDetailModal" class="modal fade" role="dialog">
            <div class="modal-dialog modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">{{ctrl.detailEvent.eventName}}</h4>
                </div>
                <div class="modal-body">
                    <form>
                        <div>
                            <input ng-readonly="!ctrl.editing" type="text" data-ng-model="ctrl.detailEvent.eventName" class="form-control" required>
                        </div>
                        <div>
                            <input ng-readonly="!ctrl.editing" type="text" data-ng-model="ctrl.detailEvent.timeStart" class="form-control" required>
                        </div>
                        <div>
                            <input ng-readonly="!ctrl.editing" type="text" data-ng-model="ctrl.detailEvent.timeEnd" class="form-control" required>
                        </div>
                        <div class="input-group">
                            <div class="input-group-addon">$</div>
                            <input ng-readonly="!ctrl.editing" min="0" max="99999999" step="0.01" string-to-number data-ng-model="ctrl.detailEvent.cost" class="form-control" required>
                        </div>
                        <div>
                            <textarea maxlength="255" ng-readonly="!ctrl.editing" type="text" name="eventDescription" data-ng-model="ctrl.detailEvent.description" class="form-control" required></textarea>
                        </div>
                        <div>
                            <input ng-readonly="true" type="text" class="form-control" placeholder="{{ctrl.detailEvent.category}}" required>
                        </div>
                        <div>
                            <input ng-readonly="true" type="text" data-ng-model="ctrl.detailEvent.createdBy" class="form-control" required>
                        </div>
                        <div>
                            <toggle-switch ng-change="ctrl.saveOriginalEvent()" on-label="Edit" off-label="View" data-ng-model="ctrl.editing">Edit</toggle-switch>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="table-button btn-success" type="button" ng-show="ctrl.detailEvent.going==0 && !ctrl.editing" ng-click="ctrl.signUpForEvent(ctrl.detailEvent)" data-dismiss="modal">Go!</button>
                    <button class="table-button btn-danger" type="button" ng-show="ctrl.detailEvent.going==1  && !ctrl.editing" ng-click="ctrl.cancelSignup(ctrl.detailEvent)">Cancel</button>
                    <button ng-show="ctrl.editing" class="table-button btn-warning" type="button" ng-click="ctrl.modifyEvent()">Modify</button>
                    <button ng-show="ctrl.editing" class="table-button btn-danger" type="button" ng-click="ctrl.deleteEvent(ctrl.detailEvent)">Delete</button>
                    <button type="button" class="table-button btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
        <div id="createEvent" class="tab-pane fade">
            <form class="form-createEvent" ng-submit="ctrl.createEvent()" name="createEvent" role="form">
                <div>
                    <label for="eventName" class="sr-only">Event Name</label>
                    <input type="text" name="eventName" data-ng-model="ctrl.eventName" id="eventName" class="form-control" placeholder="Event Name" required autofocus>
                </div>
                <div>
                    <label for="eventDescription" class="sr-only">Event Description</label>
                    <textarea maxlength="255" type="text" name="eventDescription" data-ng-model="ctrl.eventDescription" id="eventDescription" class="form-control" placeholder="Event Description" required></textarea>
                </div>
                <div class="input-group">
                    <label for="eventCost" class="sr-only">Event Cost</label>
                    <div class="input-group-addon">$</div>
                    <input min="0" max="99999999" step="0.01" value="0" required="" type="number" name="eventCost" data-ng-model="ctrl.eventCost" id="eventCost" class="form-control" placeholder="Event Cost" required>
                </div>
                <div>
                    <table id="date-table" class="table">
                        <th>
                            Event Type
                        </th>
                        <th>
                            Time Start
                        </th>
                        <th>
                            Time End
                        </th>
                        <tr>
                            <td>
                                <table id="event-type-table" class="table-hover">
                                    <th>Event Type</th>
                                    <tr ng-repeat="eventType in eventTypes" selection-model selection-model-type="checkbox" selection-model-mode="multiple-additive" selection-model-selected-items="ctrl.newEventType" selection-model-selected-class="create-group-events-selected">
                                        <td>
                                            <input type="checkbox" />
                                        </td>
                                        <td>{{eventType.category}}</td>
                                    </tr>
                                </table>
                            </td>
                            <td>
                                <datetimepicker class="dateTimePicker" data-ng-model="ctrl.timeStart"></datetimepicker>
                            </td>
                            <td>
                                <datetimepicker class="dateTimePicker" data-ng-model="ctrl.timeEnd"></datetimepicker>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <toggle-switch ng-model="ctrl.private" on-label="Private" off-label="Public">
                                </toggle-switch>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="check-element animate-show" ng-show="ctrl.private">
                    <div class="input-group">
                        <label for="invitees" class="sr-only">Invitees</label>
                        <span class="input-group-addon">@</span>
                        <input type="text" name="invitees" ng-required="ctrl.private" data-ng-model="ctrl.invitees" id="invitees" class="form-control" placeholder="Emails comma seperated" ng-list>
                    </div>
                    <div>
                        <label for="message" class="sr-only">Invite Message</label>
                        <textarea maxlength="255" class="form-control" ng-required="ctrl.private" ata-ng-model="ctrl.message" placeholder="Invite Message" rows="3"></textarea>
                    </div>
                </div>
                <button ng-disabled="form.$invalid || !ctrl.timeStart ||!ctrl.timeEnd" class="btn btn-lg btn btn-primary btn-block btn-blog" type="submit">Create Event</button>
            </form>
        </div>
        <div id="eventTypePane" class="tab-pane fade in">
            <form role="form">
                <div>
                    <table id="event-type-table" class="table-hover">
                        <th>Event Type</th>
                        <tr ng-repeat="eventType in eventTypes" selection-model selection-model-type="checkbox" selection-model-mode="single" selection-model-selected-items="ctrl.deleteET" selection-model-selected-class="create-group-events-selected" ng-hide="eventType.delete">
                            <td>
                                <input type="checkbox" />
                            </td>
                            <td>{{eventType.category}}</td>
                        </tr>
                    </table>
                </div>
                <button class="btn btn-primary" ng-click="ctrl.deleteEventTypes(deleteET)">Delete Selected</button>
            </form>
        </div>
    </div>
    <!-- https://www.kevinhooke.com/2015/06/15/angularjs-and-google-maps-dynamic-marker-updates/ -->
    <ng-map ng-hide="this.etTabView" id="event-map" center="[0,0]" zoom="13" on-click="ctrl.mapClick()">
        <marker ng-repeat="pos in positions" position="{{pos.lat}}, {{pos.lng}}"></marker>
    </ng-map>
</div>
</div>
